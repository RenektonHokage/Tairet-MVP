### ============================================
### CÓMO OBTENER ACCESS TOKEN PARA REQUESTS AUTENTICADOS
### ============================================
### 
### 1. Hacer login en http://localhost:3000/panel/login
### 2. Abrir DevTools (F12) > Console
### 3. Ejecutar: (await supabase.auth.getSession()).data.session?.access_token
### 4. Copiar el token y reemplazar {{accessToken}} en los requests que lo requieren
### 
### ============================================

### Healthcheck del Backend
GET http://localhost:4000/health

### Frontend - Landing Pública
GET http://localhost:3000/

### Frontend - Panel B2B
GET http://localhost:3000/panel

### ============================================
### PUBLIC ENDPOINTS (B2C - Sin autenticación)
### ============================================

### Obtener local por slug (bar)
GET http://localhost:4000/public/locals/by-slug/mckharthys-bar

### Obtener local por slug (club)
GET http://localhost:4000/public/locals/by-slug/morgan

### Obtener local por slug (no existe - debe retornar 404)
GET http://localhost:4000/public/locals/by-slug/local-inexistente

### Orders

### Crear orden
POST http://localhost:4000/orders
Content-Type: application/json

{
  "local_id": "550e8400-e29b-41d4-a716-446655440001",
  "quantity": 2,
  "total_amount": 100000,
  "currency": "PYG",
  "customer_email": "test@example.com",
  "customer_name": "Test User",
  "customer_phone": "+595981234567"
}

### Obtener orden por ID (reemplazar {{orderId}} con un UUID real)
GET http://localhost:4000/orders/{{orderId}}

### Marcar orden como usada (check-in manual)
PATCH http://localhost:4000/orders/{{orderId}}/use

### Payments (callback)

### Callback de pago (idempotente)
POST http://localhost:4000/payments/callback
Content-Type: application/json

{
  "event_id": "txn_123456789",
  "order_id": "{{orderId}}",
  "status": "approved"
}

### Reservas (Bares)

### Crear reserva
POST http://localhost:4000/reservations
Content-Type: application/json

{
  "local_id": "550e8400-e29b-41d4-a716-446655440001",
  "name": "Juan Pérez",
  "email": "juan@example.com",
  "phone": "+595981234567",
  "date": "2024-12-25T20:00:00Z",
  "guests": 4,
  "notes": "Mesa cerca de la ventana"
}

### Crear reserva con last_name y notes
POST http://localhost:4000/reservations
Content-Type: application/json

{
  "local_id": "550e8400-e29b-41d4-a716-446655440001",
  "name": "María",
  "last_name": "González",
  "email": "maria@example.com",
  "phone": "+595981234568",
  "date": "2024-12-26T21:00:00Z",
  "guests": 2,
  "notes": "Preferencia: mesa al aire libre"
}

### Listar reservas por local (REQUIERE AUTENTICACIÓN)
### Reemplazar {{localId}} con un UUID real y {{accessToken}} con el token del panel
GET http://localhost:4000/locals/{{localId}}/reservations
Authorization: Bearer {{accessToken}}

### Actualizar estado de reserva (Confirmar o Cancelar)
### REQUIERE AUTENTICACIÓN - Reemplazar {{reservationId}} y {{accessToken}}
PATCH http://localhost:4000/reservations/{{reservationId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "status": "confirmed"
}

### Cancelar reserva (REQUIERE AUTENTICACIÓN)
PATCH http://localhost:4000/reservations/{{reservationId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "status": "cancelled"
}

### Actualizar table_note de una reserva (requiere autenticación del panel)
PATCH http://localhost:4000/reservations/{{reservationId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "table_note": "Mesa 5 / cerca ventana"
}

### Actualizar table_note a null
PATCH http://localhost:4000/reservations/{{reservationId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "table_note": null
}

### Actualizar status y table_note simultáneamente (solo si status es en_revision)
PATCH http://localhost:4000/reservations/{{reservationId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "status": "confirmed",
  "table_note": "Mesa 3 / terraza"
}

### WhatsApp Click - Registrar
POST http://localhost:4000/events/whatsapp_click
Content-Type: application/json

{
  "local_id": "550e8400-e29b-41d4-a716-446655440001",
  "phone": "+595981234567",
  "source": "landing_boliche"
}

### WhatsApp Clicks - Count por local
GET http://localhost:4000/events/whatsapp_clicks/count?localId=550e8400-e29b-41d4-a716-446655440001

### Crear promo (REQUIERE AUTENTICACIÓN)
POST http://localhost:4000/locals/{{localId}}/promos
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "2x1 en tragos hasta las 1AM",
  "description": "Solo viernes",
  "image_url": "https://example.com/promo.jpg",
  "start_date": "2025-01-10T21:00:00Z",
  "end_date": "2025-01-11T03:00:00Z"
}

### Listar promos (REQUIERE AUTENTICACIÓN)
GET http://localhost:4000/locals/{{localId}}/promos
Authorization: Bearer {{accessToken}}

### Registrar promo abierta
POST http://localhost:4000/events/promo_open
Content-Type: application/json

{
  "promo_id": "{{promoId}}",
  "local_id": "{{localId}}",
  "source": "panel_test"
}

### Metrics Summary (REQUIERE AUTENTICACIÓN)
GET http://localhost:4000/metrics/summary?localId={{localId}}
Authorization: Bearer {{accessToken}}

### Metrics Summary con rango (REQUIERE AUTENTICACIÓN)
GET http://localhost:4000/metrics/summary?localId={{localId}}&from=2025-01-01T00:00:00Z&to=2025-12-31T23:59:59Z
Authorization: Bearer {{accessToken}}

### Profile View - Registrar (PÚBLICO - No requiere autenticación)
POST http://localhost:4000/events/profile_view
Content-Type: application/json

{
  "local_id": "{{localId}}",
  "ip_address": "1.2.3.4",
  "user_agent": "curl/8.0",
  "source": "lovable_test"
}

### ============================================
### CALENDARIO / OPERACIÓN (REQUIERE AUTENTICACIÓN)
### ============================================

### Obtener calendario mensual
### Reemplazar {{month}} con formato YYYY-MM (ej: 2025-01)
GET http://localhost:4000/panel/calendar/month?month={{month}}
Authorization: Bearer {{accessToken}}

### Obtener detalle de un día
### Reemplazar {{day}} con formato YYYY-MM-DD (ej: 2025-01-15)
GET http://localhost:4000/panel/calendar/day?day={{day}}
Authorization: Bearer {{accessToken}}

### Actualizar operación de un día (is_open y/o note)
PATCH http://localhost:4000/panel/calendar/day
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "day": "2025-01-15",
  "is_open": false,
  "note": "Cerrado por mantenimiento"
}

### Actualizar solo la nota (sin cambiar is_open)
PATCH http://localhost:4000/panel/calendar/day
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "day": "2025-01-15",
  "note": "Halloween - Evento especial"
}

### Actualizar solo el estado (sin cambiar note)
PATCH http://localhost:4000/panel/calendar/day
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "day": "2025-01-15",
  "is_open": true
}

# 1. Crear free pass
curl -X POST http://localhost:4000/orders `
  -H "Content-Type: application/json" `
  -d '{
    "local_id": "550e8400-e29b-41d4-a716-446655440006",
    "quantity": 1,
    "total_amount": 0,
    "payment_method": "free_pass",
    "customer_email": "TU_EMAIL_REAL@example.com",
    "customer_name": "Test",
    "customer_last_name": "User",
    "customer_phone": "0981234567",
    "customer_document": "1234567"
  }'

# Probar QR antifraude

  $token = "CHECKIN_TOKEN_DE_LA_ORDER"
$authToken = "BEARER_TOKEN_DEL_PANEL"

Invoke-RestMethod "http://localhost:4000/panel/checkin/$token" `
  -Method PATCH `
  -Headers @{ Authorization = "Bearer $authToken" }

$API="https://tairetapi-production.up.railway.app"

# 1) Health
Invoke-RestMethod "$API/health"

# 2) Tracking (debería devolver 204; en PowerShell puede no mostrar nada si no hay body)
$eventBody = '{"local_id":"550e8400-e29b-41d4-a716-446655440001","source":"smoke","user_agent":"smoke-test"}'
Invoke-WebRequest "$API/events/profile_view" -Method POST -Headers @{ "Content-Type"="application/json" } -Body $eventBody | Select-Object StatusCode

# 3) Reserva (201 + JSON)
$resBody = '{"local_id":"550e8400-e29b-41d4-a716-446655440001","name":"Smoke","last_name":"Test","email":"smoke@test.com","phone":"+595981000000","date":"2026-01-10T21:00:00.000Z","guests":2,"notes":"smoke prod"}'
Invoke-RestMethod "$API/reservations" -Method POST -Headers @{ "Content-Type"="application/json" } -Body $resBody



### ============================================
### NOTAS:
### - Requests marcados como "REQUIERE AUTENTICACIÓN" necesitan el header Authorization
### - Requests públicos (POST /reservations, POST /events/*, POST /orders) no requieren auth
### - Para obtener el access token, ver instrucciones al inicio del archivo
### ============================================

